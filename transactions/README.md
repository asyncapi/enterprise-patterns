# Acknowledgement & Transactions

Some brokers allow us to send messages as part of a transaction and also let us decide when to acknowledge that a message has been sent or received. In this document, we overview message acknowledgment and distributed transactions, and how to define them using AsyncAPI bindings.

## Acknowledgment

### JMS message acknowledgement

JMS has a mechanism to flag [message acknowledgement mode](https://docs.oracle.com/javaee/7/api/javax/jms/Session.html). Its values can be `AUTO_ACKNOWLEDGE`, `DUPS_OK_ACKNOWLEDGE`, `CLIENT_ACKNOWLEDGE`, and `SESSION_TRANSACTED`.

```yaml
...
channels:
  myTopicOrQueue:
    publish:
      bindings:
        jms:
          acknowledge: auto # dups_ok, client or session_transacted
      message:
        ...
```

The `acknowledge` field inside the `jms` object supports 4 possible values: `auto` (default), `dups_ok`, `client` or `session_transacted`.

#### `auto`

Maps to `AUTO_ACKNOWLEDGE`. With this acknowledgment mode, the session automatically acknowledges a client's receipt of a message either when the session has successfully returned from a call to receive or when the message listener the session has called to process the message successfully returns.

#### `dups_ok`

Maps to `DUPS_OK_ACKNOWLEDGE`. This acknowledgment mode instructs the session to lazily acknowledge the delivery of messages.

#### `client`

Maps to `CLIENT_ACKNOWLEDGE`. With this acknowledgment mode, the client acknowledges a consumed message by calling the message's acknowledge method.

#### `session_transacted`

Maps to `SESSION_TRANSACTED`. Wit this acknowledgment mode, the client will acknowledge a consumed message as part of a transaction.

## Distributed Transactions

Distributed trasactions are meant for situations when a program has to deal with multiple resources (databases, filesystem, etc.) as part of a transaction.

### JMS XA transactions

JMS XA transactions need transaction identifier (Xid) to uniquely identify a transaction over multiple resources and time.

```yaml
...
channels:
  myTopicOrQueue:
    publish:
      bindings:
        jms:
          acknowledge: session_transacted
          xid: my-transaction-id
      message:
        ...
```

Please note the `xid` field may not represent the final transaction id. Most computer programs will take the value of this field and will add unique autogenerated bytes to it.

### Kafka transactions

In the case of Kafka, the transaction id is part of the protocol and can be set on producers as `transactional.id`. We can define it with AsyncAPI as follows:

```yaml
...
channels:
  myTopic:
    publish:
      bindings:
        kafka:
          transactionalId: my-transactional-id
      message:
        ...
```
